<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>照片墙</title>
		<link rel="stylesheet" type="text/css" href="css/zxt.css"/>
<script>
window.onload=function ()
{
	var oUl=document.getElementById('ul1');
	var aLi=oUl.getElementsByTagName('li');
	var aPos=[];
	var iMinZindex=2;
	var i=0;
	
	for(i=0;i<aLi.length;i++)
	{
		aPos[i]={left: aLi[i].offsetLeft, top: aLi[i].offsetTop};
	}
	
	for(i=0;i<aLi.length;i++)
	{
		aLi[i].style.left=aPos[i].left+'px';
		aLi[i].style.top=aPos[i].top+'px';
		
		aLi[i].style.position='absolute';
		aLi[i].style.margin='0';
		
		aLi[i].index=i;
	}
	for(i=0;i<aLi.length;i++)
	{
		setDrag(aLi[i]);
	}
	
	function setDrag(obj)
	{
		obj.onmousedown=function (ev)
		{
			var oEvent=ev||event;
			
			obj.style.zIndex=iMinZindex++;
			
			var disX=oEvent.clientX-obj.offsetLeft;
			var disY=oEvent.clientY-obj.offsetTop;
			
			document.onmousemove=function (ev)
			{
				var oEvent=ev||event;
				
				obj.style.left=oEvent.clientX-disX+'px';
				obj.style.top=oEvent.clientY-disY+'px';
				
				for(i=0;i<aLi.length;i++)
				{
					aLi[i].className='';
				}
				
				var oNear=findNearest(obj);
				
				if(oNear)
				{
					oNear.className='active';
				}
				
			};
			
			document.onmouseup=function ()
			{
				document.onmousemove=null;
				document.onmouseup=null;
				
				var oNear=findNearest(obj);
				
				if(oNear)
				{
				
					oNear.className='';
					
					oNear.style.zIndex=iMinZindex++;
					obj.style.zIndex=iMinZindex++;
					
					startMove(oNear, aPos[obj.index]);
					startMove(obj, aPos[oNear.index]);
					
					var tmp=0;
					
					tmp=obj.index;
					obj.index=oNear.index;
					oNear.index=tmp;
				}
				else
				{
					startMove(obj, aPos[obj.index]);
				}
			};
			
			clearInterval(obj.timer);
			
			return false;
		};
	}
	
	//碰撞检测
	function cdTest(obj1, obj2)
	{
		var l1=obj1.offsetLeft;
		var r1=obj1.offsetLeft+obj1.offsetWidth;
		var t1=obj1.offsetTop;
		var b1=obj1.offsetTop+obj1.offsetHeight;
		
		var l2=obj2.offsetLeft;
		var r2=obj2.offsetLeft+obj2.offsetWidth;
		var t2=obj2.offsetTop;
		var b2=obj2.offsetTop+obj2.offsetHeight;
		
		if(r1<l2 || l1>r2 || b1<t2 || t1>b2)
		{
			return false;
		}
		else
		{
			return true;
		}
	}
	
	function getDis(obj1, obj2)
	{
		var a=obj1.offsetLeft-obj2.offsetLeft;
		var b=obj1.offsetTop-obj2.offsetTop;
		
		return Math.sqrt(a*a+b*b);
	}
	
	function findNearest(obj)	//找到碰上的，并且最近的
	{
		var iMin=999999999;
		var iMinIndex=-1;
		
		for(i=0;i<aLi.length;i++)
		{
			if(obj==aLi[i])continue;
			
			if(cdTest(obj, aLi[i]))
			{
				var dis=getDis(obj, aLi[i]);
				
				if(iMin>dis)
				{
					iMin=dis;
					iMinIndex=i;
				}
			}
		}
		
		if(iMinIndex==-1)
		{
			return null;
		}
		else
		{
			return aLi[iMinIndex];
		}
	}
	
	//运动
	function getStyle(obj, attr)
{
	if(obj.currentStyle)
	{
		return obj.currentStyle[attr];
	}
	else
	{
		return getComputedStyle(obj, false)[attr];
	}
}

function startMove(obj, json, fn)
{
	clearInterval(obj.timer);
	obj.timer=setInterval(function (){
		var bStop=true;		
		for(var attr in json)
		{ֵ
			var iCur=0;
			
			if(attr=='opacity')
			{
				iCur=parseInt(parseFloat(getStyle(obj, attr))*100);
			}
			else
			{
				iCur=parseInt(getStyle(obj, attr));
			}
			
		
			var iSpeed=(json[attr]-iCur)/8;
			iSpeed=iSpeed>0?Math.ceil(iSpeed):Math.floor(iSpeed);
ֹ
			if(iCur!=json[attr])
			{
				bStop=false;
			}
			
			if(attr=='opacity')
			{
				obj.style.filter='alpha(opacity:'+(iCur+iSpeed)+')';
				obj.style.opacity=(iCur+iSpeed)/100;
			}
			else
			{
				obj.style[attr]=iCur+iSpeed+'px';
			}
		}
		
		if(bStop)
		{
			clearInterval(obj.timer);
			
			if(fn)
			{
				fn();
			}
		}
	}, 30)
}
};
</script>
	<style>
* {margin:0; padding:0;}

#ul1 {width:1600px; position:relative; margin:10px auto;}
#ul1 li {width:200px; height:300px; float:left; list-style:none; margin:10px; z-index:1;}
#ul1 .active {border:1px dashed red;}
li img{width: 200px;height: 300px;
}
</style>
	</head>
	<body>
		<ul id="ul1">
	<li><img src="img/369.jpg" /></li>
	<li><img src="img/333.jpg" /></li>
	<li><img src="img/789sb.jpg" /></li>
	<li><img src="img/asdfghjk.jpg" /></li>
	<li><img src="img/、。mb.jpg" /></li>
	<li><img src="img/asdgh.jpg" /></li>
	<li><img src="img/cvbb.jpg" /></li>
	<li><img src="img/fghjmnbvsb.jpg" /></li>
	<li><img src="img/p..jpg" /></li>
	<li><img src="img/pasdsb.jpg" /></li>
	<li><img src="img/364sb.jpg" /></li>
    <li><img src="img/36b.jpg" /></li>
			<li><img src="img/3b.jpg" /></li>
			<li><img src="img/3sb.jpg" /></li>
			<li><img src="img/78532b.jpg" /></li>
			<li><img src="img/79sb.jpg" /></li>
			<li><img src="img/asdb.jpg" /></li>
			<li><img src="img/asdfhjsb.jpg" /></li>
			<li><img src="img/ertyb.jpg" /></li>
			<li><img src="img/p1sb.jpg" /></li>
			<li><img src="img/phgasvsb.jpg" /></li>
			<li><img src="img/pqwertyusb.jpg" /></li>
			<li><img src="img/ps3b.jpg" /></li>
			<li><img src="img/ps5555b.jpg" /></li>
			<li><img src="img/ps78b.jpg" /></li>
			<li><img src="img/psb123.jpg" /></li>
			<li><img src="img/psasfdb.jpg" /></li>
			
			
</ul>
	</body>
</html>
